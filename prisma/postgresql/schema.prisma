generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource postgres {
  provider = "postgresql"
  url      = env("POSTGRESQL_URL")
}

// -----------------------------------------------------------------------------
// API Call Log - 详细日志存储
// -----------------------------------------------------------------------------
model ApiCallLog {
  requestId String @id @postgres.VarChar(26) // 使用 ULID 作为全局唯一请求ID

  // 冗余鉴权字段，方便快速查询和权限验证
  walletId      Int    @postgres.Integer // 关联钱包ID
  walletUid     String @postgres.VarChar(36) // 钱包UID（冗余）
  userId        Int    @postgres.Integer // 调用用户ID
  userUid       String @postgres.VarChar(36) // 用户UID（冗余）
  ownerId       Int    @postgres.Integer // 钱包所有者ID（冗余）
  ownerUid      String @postgres.VarChar(36) // 钱包所有者UID（冗余）
  apikeyId      Int    @postgres.Integer // API Key ID
  apiKeyPreview String @postgres.VarChar(8) // API Key 预览（冗余）

  // 请求和响应内容
  requestHeaders  Json? // 请求头
  requestBody     Json? // 请求体
  responseHeaders Json? // 响应头
  responseBody    Json? // 响应体
  responseStream  Boolean @default(false) // 是否流式响应

  // 审计信息
  createdAt DateTime @default(now())

  @@index([walletId, createdAt(sort: Desc)]) // 钱包owner查询
  @@index([userId, createdAt(sort: Desc)]) // 用户查询
  @@index([walletId, userId, createdAt(sort: Desc)]) // 用户在钱包中的查询
  @@map("api_call_logs")
}
